// Backbone.js 0.9.2 (master 2012-29-10)

// (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Backbone may be freely distributed under the MIT license.
// For all details and documentation:
// http://backbonejs.org
(function(){var r=this;var p=r.Backbone;var h=Array.prototype;var g=h.push;var q=h.slice;var A=h.splice;var d;if(typeof exports!=="undefined"){d=exports}else{d=r.Backbone={}}d.VERSION="0.9.2";var C=r._;if(!C&&(typeof require!=="undefined")){C=require("underscore")}d.$=r.jQuery||r.Zepto||r.ender;d.noConflict=function(){r.Backbone=p;return this};d.emulateHTTP=false;d.emulateJSON=false;var a=/\s+/;var o=d.Events={on:function(G,J,F){var E,H,I;if(!J){return this}G=G.split(a);E=this._callbacks||(this._callbacks={});while(H=G.shift()){I=E[H]||(E[H]=[]);I.push(J,F)}return this},off:function(H,K,G){var I,F,J,E;if(!(F=this._callbacks)){return this}if(!(H||K||G)){delete this._callbacks;return this}H=H?H.split(a):C.keys(F);while(I=H.shift()){if(!(J=F[I])||!(K||G)){delete F[I];continue}for(E=J.length-2;E>=0;E-=2){if(!(K&&J[E]!==K||G&&J[E+1]!==G)){J.splice(E,2)}}}return this},trigger:function(L){var E,M,I,H,G,J,K,F;if(!(M=this._callbacks)){return this}F=[];L=L.split(a);for(H=1,G=arguments.length;H<G;H++){F[H-1]=arguments[H]}while(E=L.shift()){if(K=M.all){K=K.slice()}if(I=M[E]){I=I.slice()}if(I){for(H=0,G=I.length;H<G;H+=2){I[H].apply(I[H+1]||this,F)}}if(K){J=[E].concat(F);for(H=0,G=K.length;H<G;H+=2){K[H].apply(K[H+1]||this,J)}}}return this}};o.bind=o.on;o.unbind=o.off;var m=d.Model=function(E,G){var H;var F=E||{};if(G&&G.collection){this.collection=G.collection}if(G&&G.parse){F=this.parse(F)}if(H=C.result(this,"defaults")){F=C.extend({},H,F)}this.attributes={};this._escapedAttributes={};this.cid=C.uniqueId("c");this.changed={};this._changes={};this._pending={};this.set(F,{silent:true});this.changed={};this._changes={};this._pending={};this._previousAttributes=C.clone(this.attributes);this.initialize.apply(this,arguments)};C.extend(m.prototype,o,{changed:null,_changes:null,_pending:null,_changing:null,idAttribute:"id",initialize:function(){},toJSON:function(E){return C.clone(this.attributes)},sync:function(){return d.sync.apply(this,arguments)},get:function(E){return this.attributes[E]},escape:function(E){var F;if(F=this._escapedAttributes[E]){return F}var G=this.get(E);return this._escapedAttributes[E]=C.escape(G==null?"":""+G)},has:function(E){return this.get(E)!=null},set:function(K,G,O){var J,L;if(K==null){return this}if(C.isObject(K)){L=K;O=G}else{(L={})[K]=G}var I=O&&O.silent;var M=O&&O.unset;if(L instanceof m){L=L.attributes}if(M){for(J in L){L[J]=void 0}}if(!this._validate(L,O)){return false}if(this.idAttribute in L){this.id=L[this.idAttribute]}var N=this._changing;var F=this.attributes;var E=this._escapedAttributes;var H=this._previousAttributes||{};for(J in L){G=L[J];if(!C.isEqual(F[J],G)||(M&&C.has(F,J))){delete E[J];this._changes[J]=true}M?delete F[J]:F[J]=G;if(!C.isEqual(H[J],G)||(C.has(F,J)!==C.has(H,J))){this.changed[J]=G;if(!I){this._pending[J]=true}}else{delete this.changed[J];delete this._pending[J];if(!N){delete this._changes[J]}}if(N&&C.isEqual(F[J],N[J])){delete this._changes[J]}}if(!I){this.change(O)}return this},unset:function(E,F){F=C.extend({},F,{unset:true});return this.set(E,null,F)},clear:function(E){E=C.extend({},E,{unset:true});return this.set(C.clone(this.attributes),E)},fetch:function(F){F=F?C.clone(F):{};var E=this;var G=F.success;F.success=function(J,H,I){if(!E.set(E.parse(J,I),F)){return false}if(G){G(E,J,F)}};return this.sync("read",this,F)},save:function(J,E,N){var K,I,F;if(J==null||C.isObject(J)){K=J;N=E}else{if(J!=null){(K={})[J]=E}}N=N?C.clone(N):{};if(N.wait){if(!this._validate(K,N)){return false}I=C.clone(this.attributes)}var G=C.extend({},N,{silent:true});if(K&&!this.set(K,N.wait?G:N)){return false}if(!K&&!this._validate(null,N)){return false}var H=this;var L=N.success;N.success=function(R,O,Q){F=true;var P=H.parse(R,Q);if(N.wait){P=C.extend(K||{},P)}if(!H.set(P,N)){return false}if(L){L(H,R,N)}};var M=this.sync(this.isNew()?"create":"update",this,N);if(!F&&N.wait){this.clear(G);this.set(I,G)}return M},destroy:function(F){F=F?C.clone(F):{};var E=this;var I=F.success;var G=function(){E.trigger("destroy",E,E.collection,F)};F.success=function(J){if(F.wait||E.isNew()){G()}if(I){I(E,J,F)}};if(this.isNew()){F.success();return false}var H=this.sync("delete",this,F);if(!F.wait){G()}return H},url:function(){var E=C.result(this,"urlRoot")||C.result(this.collection,"url")||u();if(this.isNew()){return E}return E+(E.charAt(E.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(F,E){return F},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(G){var L=this._changing;var K=this._changing={};for(var E in this._changes){this._pending[E]=true}var J=this._changes;this._changes={};var I=[];for(var E in J){K[E]=this.get(E);I.push(E)}for(var H=0,F=I.length;H<F;H++){this.trigger("change:"+I[H],this,K[I[H]],G)}if(L){return this}while(!C.isEmpty(this._pending)){this._pending={};this.trigger("change",this,G);for(var E in this.changed){if(this._pending[E]||this._changes[E]){continue}delete this.changed[E]}this._previousAttributes=C.clone(this.attributes)}this._changing=null;return this},hasChanged:function(E){if(E==null){return !C.isEmpty(this.changed)}return C.has(this.changed,E)},changedAttributes:function(G){if(!G){return this.hasChanged()?C.clone(this.changed):false}var I,H=false,F=this._previousAttributes;for(var E in G){if(C.isEqual(F[E],(I=G[E]))){continue}(H||(H={}))[E]=I}return H},previous:function(E){if(E==null||!this._previousAttributes){return null}return this._previousAttributes[E]},previousAttributes:function(){return C.clone(this._previousAttributes)},isValid:function(E){return !this.validate||!this.validate(this.attributes,E)},_validate:function(G,F){if(F&&F.silent||!this.validate){return true}G=C.extend({},this.attributes,G);var E=this.validate(G,F);if(!E){return true}if(F&&F.error){F.error(this,E,F)}this.trigger("error",this,E,F);return false}});var D=d.Collection=function(F,E){E||(E={});if(E.model){this.model=E.model}if(E.comparator!==void 0){this.comparator=E.comparator}this._reset();this.initialize.apply(this,arguments);if(F){if(E.parse){F=this.parse(F)}this.reset(F,{silent:true,parse:E.parse})}};C.extend(D.prototype,o,{model:m,initialize:function(){},toJSON:function(E){return this.map(function(F){return F.toJSON(E)})},sync:function(){return d.sync.apply(this,arguments)},add:function(L,H){var I,G,K,F,J;var E=H&&H.at;L=C.isArray(L)?L.slice():[L];for(I=0,K=L.length;I<K;I++){if(L[I]=this._prepareModel(L[I],H)){continue}throw new Error("Can't add an invalid model to a collection")}for(I=L.length-1;I>=0;I--){F=L[I];J=F.id!=null&&this._byId[F.id];if(J||this._byCid[F.cid]){if(H&&H.merge&&J){J.set(F,H)}L.splice(I,1);continue}F.on("all",this._onModelEvent,this);this._byCid[F.cid]=F;if(F.id!=null){this._byId[F.id]=F}}this.length+=L.length;G=[E!=null?E:this.models.length,0];g.apply(G,L);A.apply(this.models,G);if(this.comparator&&E==null){this.sort({silent:true})}if(H&&H.silent){return this}while(F=L.shift()){F.trigger("add",F,this,H)}return this},remove:function(J,H){var I,E,G,F;H||(H={});J=C.isArray(J)?J.slice():[J];for(I=0,E=J.length;I<E;I++){F=this.getByCid(J[I])||this.get(J[I]);if(!F){continue}delete this._byId[F.id];delete this._byCid[F.cid];G=this.indexOf(F);this.models.splice(G,1);this.length--;if(!H.silent){H.index=G;F.trigger("remove",F,this,H)}this._removeReference(F)}return this},push:function(F,E){F=this._prepareModel(F,E);this.add(F,E);return F},pop:function(F){var E=this.at(this.length-1);this.remove(E,F);return E},unshift:function(F,E){F=this._prepareModel(F,E);this.add(F,C.extend({at:0},E));return F},shift:function(F){var E=this.at(0);this.remove(E,F);return E},slice:function(F,E){return this.models.slice(F,E)},get:function(E){if(E==null){return void 0}return this._byId[E.id!=null?E.id:E]},getByCid:function(E){return E&&this._byCid[E.cid||E]},at:function(E){return this.models[E]},where:function(E){if(C.isEmpty(E)){return[]}return this.filter(function(F){for(var G in E){if(E[G]!==F.get(G)){return false}}return true})},sort:function(E){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}if(C.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(C.bind(this.comparator,this))}if(!E||!E.silent){this.trigger("reset",this,E)}return this},pluck:function(E){return C.invoke(this.models,"get",E)},reset:function(H,F){for(var G=0,E=this.models.length;G<E;G++){this._removeReference(this.models[G])}this._reset();if(H){this.add(H,C.extend({silent:true},F))}if(!F||!F.silent){this.trigger("reset",this,F)}return this},fetch:function(E){E=E?C.clone(E):{};if(E.parse===void 0){E.parse=true}var G=this;var F=E.success;E.success=function(J,H,I){G[E.add?"add":"reset"](G.parse(J,I),E);if(F){F(G,J,E)}};return this.sync("read",this,E)},create:function(F,E){var H=this;E=E?C.clone(E):{};F=this._prepareModel(F,E);if(!F){return false}if(!E.wait){H.add(F,E)}var G=E.success;E.success=function(J,K,I){if(I.wait){H.add(J,I)}if(G){G(J,K,I)}};F.save(null,E);return F},parse:function(F,E){return F},clone:function(){return new this.constructor(this.models)},chain:function(){return C(this.models).chain()},_reset:function(E){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(G,F){if(G instanceof m){if(!G.collection){G.collection=this}return G}F||(F={});F.collection=this;var E=new this.model(G,F);if(!E._validate(E.attributes,F)){return false}return E},_removeReference:function(E){if(this===E.collection){delete E.collection}E.off("all",this._onModelEvent,this)},_onModelEvent:function(G,F,H,E){if((G==="add"||G==="remove")&&H!==this){return}if(G==="destroy"){this.remove(F,E)}if(F&&G==="change:"+F.idAttribute){delete this._byId[F.previous(F.idAttribute)];if(F.id!=null){this._byId[F.id]=F}}this.trigger.apply(this,arguments)}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortedIndex","toArray","size","first","head","take","initial","rest","tail","last","without","indexOf","shuffle","lastIndexOf","isEmpty"];C.each(y,function(E){D.prototype[E]=function(){var F=q.call(arguments);F.unshift(this.models);return C[E].apply(C,F)}});var i=["groupBy","countBy","sortBy"];C.each(i,function(E){D.prototype[E]=function(H,F){var G=C.isFunction(H)?H:function(I){return I.get(H)};return C[E](this.models,G,F)}});var B=d.Router=function(E){E||(E={});if(E.routes){this.routes=E.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var l=/\((.*?)\)/g;var j=/:\w+/g;var z=/\*\w+/g;var e=/[-{}[\]+?.,\\^$|#\s]/g;C.extend(B.prototype,o,{initialize:function(){},route:function(E,F,G){if(!C.isRegExp(E)){E=this._routeToRegExp(E)}if(!G){G=this[F]}d.history.route(E,C.bind(function(I){var H=this._extractParameters(E,I);G&&G.apply(this,H);this.trigger.apply(this,["route:"+F].concat(H));d.history.trigger("route",this,F,H)},this));return this},navigate:function(F,E){d.history.navigate(F,E);return this},_bindRoutes:function(){if(!this.routes){return}var F,E=C.keys(this.routes);while((F=E.pop())!=null){this.route(F,this.routes[F])}},_routeToRegExp:function(E){E=E.replace(e,"\\$&").replace(l,"(?:$1)?").replace(j,"([^/]+)").replace(z,"(.*?)");return new RegExp("^"+E+"$")},_extractParameters:function(E,F){return E.exec(F).slice(1)}});var b=d.History=function(){this.handlers=[];C.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var n=/^[#\/]/;var x=/^\/+|\/+$/g;var k=/msie [\w.]+/;var c=/\/$/;b.started=false;C.extend(b.prototype,o,{interval:50,getHash:function(F){var E=(F||this).location.href.match(/#(.*)$/);return E?E[1]:""},getFragment:function(G,F){if(G==null){if(this._hasPushState||!this._wantsHashChange||F){G=this.location.pathname;var E=this.root.replace(c,"");if(!G.indexOf(E)){G=G.substr(E.length)}}else{G=this.getHash()}}return decodeURIComponent(G.replace(n,""))},start:function(G){if(b.started){throw new Error("Backbone.history has already been started")}b.started=true;this.options=C.extend({},{root:"/"},this.options,G);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var F=this.getFragment();var E=document.documentMode;var I=(k.exec(navigator.userAgent.toLowerCase())&&(!E||E<=7));this.root=("/"+this.root+"/").replace(x,"/");if(I&&this._wantsHashChange){this.iframe=d.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(F)}if(this._hasPushState){d.$(window).bind("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!I){d.$(window).bind("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=F;var J=this.location;var H=J.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!H){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&H&&J.hash){this.fragment=this.getHash().replace(n,"");this.history.replaceState({},document.title,this.root+this.fragment+J.search)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){d.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);b.started=false},route:function(E,F){this.handlers.unshift({route:E,callback:F})},checkUrl:function(F){var E=this.getFragment();if(E===this.fragment&&this.iframe){E=this.getFragment(this.getHash(this.iframe))}if(E===this.fragment){return false}if(this.iframe){this.navigate(E)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(G){var F=this.fragment=this.getFragment(G);var E=C.any(this.handlers,function(H){if(H.route.test(F)){H.callback(F);return true}});return E},navigate:function(G,F){if(!b.started){return false}if(!F||F===true){F={trigger:F}}G=this.getFragment(G||"");if(this.fragment===G){return}this.fragment=G;var E=this.root+G;if(this._hasPushState){this.history[F.replace?"replaceState":"pushState"]({},document.title,E)}else{if(this._wantsHashChange){this._updateHash(this.location,G,F.replace);if(this.iframe&&(G!==this.getFragment(this.getHash(this.iframe)))){if(!F.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,G,F.replace)}}else{return this.location.assign(E)}}if(F.trigger){this.loadUrl(G)}},_updateHash:function(E,G,H){if(H){var F=E.href.replace(/(javascript:|#).*$/,"");E.replace(F+"#"+G)}else{E.hash="#"+G}}});d.history=new b;var t=d.View=function(E){this.cid=C.uniqueId("view");this._configure(E||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var f=/^(\S+)\s*(.*)$/;var v=["model","collection","el","id","attributes","className","tagName"];C.extend(t.prototype,o,{tagName:"div",$:function(E){return this.$el.find(E)},initialize:function(){},render:function(){return this},dispose:function(){this.undelegateEvents();if(this.model&&this.model.off){this.model.off(null,null,this)}if(this.collection&&this.collection.off){this.collection.off(null,null,this)}return this},remove:function(){this.dispose();this.$el.remove();return this},make:function(F,E,H){var G=document.createElement(F);if(E){d.$(G).attr(E)}if(H!=null){d.$(G).html(H)}return G},setElement:function(E,F){if(this.$el){this.undelegateEvents()}this.$el=E instanceof d.$?E:d.$(E);this.el=this.$el[0];if(F!==false){this.delegateEvents()}return this},delegateEvents:function(I){if(!(I||(I=C.result(this,"events")))){return}this.undelegateEvents();for(var H in I){var J=I[H];if(!C.isFunction(J)){J=this[I[H]]}if(!J){throw new Error('Method "'+I[H]+'" does not exist')}var G=H.match(f);var F=G[1],E=G[2];J=C.bind(J,this);F+=".delegateEvents"+this.cid;if(E===""){this.$el.bind(F,J)}else{this.$el.delegate(E,F,J)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(E){if(this.options){E=C.extend({},this.options,E)}C.extend(this,C.pick(E,v));this.options=E},_ensureElement:function(){if(!this.el){var E=C.extend({},C.result(this,"attributes"));if(this.id){E.id=C.result(this,"id")}if(this.className){E["class"]=C.result(this,"className")}this.setElement(this.make(C.result(this,"tagName"),E),false)}else{this.setElement(C.result(this,"el"),false)}}});var s={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};d.sync=function(L,G,F){var I=s[L];F||(F={});var K={type:I,dataType:"json"};if(!F.url){K.url=C.result(G,"url")||u()}if(!F.data&&G&&(L==="create"||L==="update")){K.contentType="application/json";K.data=JSON.stringify(G)}if(d.emulateJSON){K.contentType="application/x-www-form-urlencoded";K.data=K.data?{model:K.data}:{}}if(d.emulateHTTP&&(I==="PUT"||I==="DELETE")){K.type="POST";if(d.emulateJSON){K.data._method=I}var H=F.beforeSend;F.beforeSend=function(M){M.setRequestHeader("X-HTTP-Method-Override",I);if(H){return H.apply(this,arguments)}}}if(K.type!=="GET"&&!d.emulateJSON){K.processData=false}var J=F.success;F.success=function(O,M,N){if(J){J(O,M,N)}G.trigger("sync",G,O,F)};var E=F.error;F.error=function(O,M,N){if(E){E(G,O,F)}G.trigger("error",G,O,F)};return d.ajax(C.extend(K,F))};d.ajax=function(){return d.$.ajax.apply(d.$,arguments)};var w=function(E,G){var F=this;var I;if(E&&C.has(E,"constructor")){I=E.constructor}else{I=function(){F.apply(this,arguments)}}C.extend(I,F,G);var H=function(){this.constructor=I};H.prototype=F.prototype;I.prototype=new H;if(E){C.extend(I.prototype,E)}I.__super__=F.prototype;return I};m.extend=D.extend=B.extend=t.extend=b.extend=w;var u=function(){throw new Error('A "url" property or function must be specified')}}).call(this);